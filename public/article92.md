---
title: 【Web】サーバーの負荷分散
tags:
  - Web
  - 初心者
  - ロードバランサー
  - 未経験エンジニア
  - 独学
private: false
updated_at: '2024-12-29T13:02:13+09:00'
id: 2d215f8b469df2e68e97
organization_url_name: null
slide: false
ignorePublish: false
---
# はじめに
こんにちは。アメリカで独学でエンジニアを目指している者です。

現在、Webについて勉強しており、特にシステムのスケーラビリティと可用性を高める技術として負荷分散について学んでいます。負荷分散に関連する技術として、ロードバランサーが果たす役割や代表的な分散方式であるラウンドロビン方式、動的分散方式、およびパーシステンスについてまとめました。

## 負荷分散とは？

負荷分散とは、複数のサーバーやリソースに対してクライアントからのリクエストを効果的に分配する技術です。
これにより、各サーバーの負荷を均等化し、システム全体のパフォーマンス向上や可用性の確保が可能になります。
ロードバランサーは、この負荷分散を実現するための専用のデバイスまたはソフトウェアです。

## ロードバランサーの主要な方式

ロードバランサーにはさまざまな分散方式が存在しますが、ここでは代表的なラウンドロビン方式、動的分散方式、およびこれらのデメリットをカバーするパーシステンスについて詳しく説明します。

### 1. ラウンドロビン方式

ラウンドロビン方式は、最もシンプルで広く使用されている負荷分散方式の一つです。この方式では、ロードバランサーが受け取ったリクエストを順番に各サーバーに割り当てていきます。具体的には、最初のリクエストをサーバーAに、次のリクエストをサーバーBに、その次をサーバーCに…という具合に繰り返します。

#### 特徴:

- **シンプルで実装が容易**: 特別な設定や状態管理が不要。
- **均等な負荷分散**: 各サーバーに均等にリクエストが分配される。

#### 欠点:

- **サーバーの性能差を考慮しない**: 高性能なサーバーと低性能なサーバーが混在する環境では最適な負荷分散ができない。
- **セッションの一貫性が確保されない**: 特定のユーザーセッションが複数のサーバーに分散される可能性がある。

### 2. 動的分散方式

動的分散方式（ダイナミックロードバランシング）は、各サーバーの現在の負荷状況や応答時間などをリアルタイムで監視し、それに基づいてリクエストを動的に分配する方式です。この方式では、負荷が高いサーバーにはリクエストを少なくし、負荷が低いサーバーに多くのリクエストを割り当てることで、全体のパフォーマンスを最適化します。

#### 特徴:

- **負荷状況に応じた最適な分散**: サーバーの状態を反映してリクエストを分配するため、効率的な負荷分散が可能。
- **柔軟性が高い**: サーバーの追加や削除が容易に反映される。

#### 欠点:

- **実装が複雑**: リアルタイムでの負荷監視と判断が必要。
- **オーバーヘッドが増加**: 負荷情報の収集と処理にリソースが必要。

### 3. パーシステンス（セッション持続性）

パーシステンス（セッション持続性）は、特定のクライアントからのリクエストを常に同じサーバーに割り当てる方式です。ラウンドロビン方式や動的分散方式では、同じクライアントのリクエストが異なるサーバーに分散される可能性があり、これがセッション情報の管理を困難にします。パーシステンスを導入することで、ユーザーセッションの一貫性が保たれ、状態を保持したサービス提供が可能となります。パーシステンスは、ユーザー認証やカート情報の保持など、セッション情報を必要とするアプリケーションにおいて重要です。

#### 実装方法:

- **IPアドレスによる方法**: クライアントのIPアドレスを基に特定のサーバーに割り当てる。
- **クッキーによる方法**: クライアントにクッキーを設定し、その情報を基にサーバーを選択する。

#### 特徴:

- **セッションの一貫性**: 同一ユーザーのリクエストが常に同じサーバーに届くため、セッション管理が容易。
- **ユーザー体験の向上**: 状態を保持したサービス提供が可能

#### 欠点:

- **負荷分散の不均一化**: 特定のサーバーにリクエストが集中する可能性がある。
- **スケーラビリティの制限**: サーバーの追加や削除がパーシステンスの設定に影響を与える場合がある。


## まとめ
負荷分散には主にラウンドロビン方式と動的分散方式があり、サーバーの処理能力が同等であれば前者、サーバーごとに処理能力が異なる場合は後者を選ぶのが適しています。しかし、これらの分散方式を単独で使用すると、ユーザーセッションの一貫性を保つことが難しくなることがあります。そこで、パーシステンスを併用することで、セッション情報の管理を容易にし、ユーザー体験を向上させることが可能です。
