---
title: 【Ruby】特殊文字 $`と$'
tags:
  - Ruby
  - 初心者
  - 特殊文字
  - 未経験エンジニア
  - 独学
private: false
updated_at: '2024-12-11T14:44:40+09:00'
id: 3fae1c19ad837a983e77
organization_url_name: null
slide: false
ignorePublish: false
---
# はじめに
こんにちは！アメリカの大学で語学を学びながら、独学でソフトウェアエンジニアを目指している者です。
今回は正規表現の特殊変数であるドルバッククォートとドルシングルクォートについて解説していきます。正規表現はパターンマッチを擦るうえで欠かせないのでこれらの役割についてしっかり学びましょう。

## \$` と \$' の役割
ドルバッククォートとドルシングルクォート は、正規表現のマッチングにおいて特定の部分を参照するための特殊変数です。
これら2つを記号で表したいのですが、うまくいかなかったのでカタカナで書いています。

* \$` (ドルバッククォート) は、マッチした部分の「前の文字列」を保持します。
* \$' (ドルシングルクォート)は、マッチした部分の「後ろの文字列」を保持します。

例えば、/abc/ というパターンを使って文字列にマッチさせた場合、マッチ前の部分が ドルバッククォート に、マッチ後の部分が ドルシングルクォート に格納されます。

## \$` と \$' の使い方
実際に ドルバッククォートと ドルシングルクォート を使った例を見てみましょう。例えば、以下のような文字列があるとします
```ruby
text = "私はシャーロック・ホームズを訪ねた。"
pattern = /ホームズ/
if pattern =~ text
  puts "マッチ前: #{$`}"   # => "私はシャーロック・"
  puts "マッチ後: #{$'}"   # => "を訪ねた。"
end
```
## 具体例
私がこれらを知ったのは以下のコードを通してです。実際に見てみましょう。
```ruby

pattern = Regexp.new(ARGV[0].encode("UTF-8"))
filename = ARGV[1]
len = ARGV[2]
count = 0

File.open(filename, "r:UTF-8") do |file|
  file.each_line do |line|
    if pattern =~ line
      line.scan(pattern) do |s|
        pre = "\u3000" * len + $`
        post = $'
        puts "#{pre[-len, len]}<<#{s}>>#{post[0, len]}"
        count += 1
      end
    end
  end
end
puts "count: #{count}"
```
上記はターミナルに入力されたある文字列を探して、その周りのテキストを表示するコードです。
コードの詳細説明は以下の通りです
1. `pattern = Regexp.new(ARGV[0].encode("UTF-8"))`
コマンドライン引数で与えられたパターンをUTF-8エンコーディングで正規表現に変換します。
2. `line.scan(pattern) do |s|`
各行を `pattern` にマッチさせ、マッチした部分（s）を処理します。

3. `pre = "\u3000" * len + ドルバッククォート` と `post = ドルシングルクォート`
ドルバッククォート と ドルシングルクォート によって、マッチした部分の前後の文字列が取得されます。

4. `puts "#{pre[-len, len]}<<#{s}>>#{post[0, len]}"`
マッチ部分（s）を表示する前に、その前後ターミナルに入力された文字数を表示します。

# まとめ
ドルバッククォート と ドルシングルクォート は、正規表現のマッチングにおいて非常に有用な変数で、特定のパターンが文字列にどのように一致したかを簡単に把握できます。
ドルバッククォート はマッチ前、ドルシングルクォート はマッチ後の文字列を保持するため、これらを使うことでより詳細な文字列操作が可能になります。
