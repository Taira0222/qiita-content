---
title: 【Ruby】シングルクォートとpの意外な性質
tags:
  - Ruby
  - 初心者
  - p
  - 未経験エンジニア
  - 独学
private: false
updated_at: '2024-11-13T15:36:32+09:00'
id: d4aae265a62b9b1cd830
organization_url_name: null
slide: false
ignorePublish: false
---
# はじめに
こんにちは！アメリカの大学で語学を学びながら、独学でソフトウェアエンジニアを目指している者です。
文字列の扱いにおいて「シングルクォート」と「ダブルクォート」の違いはご存じだと思います。
シングルクォートは式展開を無効にするため、プログラムの挙動を確認したいときに役立ちますが、さらに意外な性質があることをご存じでしょうか？
この記事では、シングルクォートでバックスラッシュがそのまま出力されることと、`p` メソッドと組み合わせたときの動きを詳しく見ていきます。

## シングルクォートとダブルクォートの違いをおさらい
まずは、シングルクォートとダブルクォートの基本的な違いを簡単におさらいしておきましょう。

### ダブルクォート（`"`）
式展開 `#{}` や特殊文字（例えば `\n` など）が有効です。
```ruby
name = "田中"
greeting = "こんにちは、#{name}さん"
puts greeting  # => こんにちは、田中さん
```

### シングルクォート（`'`）
式展開や特殊文字が無効で、文字列がそのまま出力されます。
```ruby
greeting = 'こんにちは、#{name}さん'
puts greeting  # => こんにちは、#{name}さん
```

## シングルクォートではバックスラッシュがそのまま出力される
シングルクォートは式展開や特殊文字が無効であるため、例えば `\n` は改行を意味せず、そのまま「`\n`」という文字列として扱われます。
バックスラッシュ自体もそのまま表示されるので、次のようなコードでは、文字列内に `\` が残ったまま出力される点に注意が必要です。
```ruby
str = 'これはシングルクォートの\n性質です'
puts str  # => これはシングルクォートの\n性質です
```

## `p` メソッドとシングルクォートの組み合わせによる挙動
では本題の`p` メソッドとシングルクォートの組み合わせについて見てみましょう。
`p` メソッドは、引数のオブジェクトをそのまま視覚化して表示するため、デバッグに役立ちます。
`p` メソッドを使用すると、特殊文字やバックスラッシュが文字列リテラルのまま表現されるため、シングルクォート内でエスケープが無効であることが際立つ場合があります。

```ruby
str = 'これはシングルクォートの\n性質です'

p str  # => "これはシングルクォートの\\n性質です"
```
## バックスラッシュが二重になる理由
シングルクォートでは `\n` などの特殊文字が通常の文字として扱われますが、`p` メソッドを使うと、オブジェクトを文字列リテラルとして再現する際に、表示する特殊文字やバックスラッシュが追加で表示されます。
これは、`p` メソッドがRubyコードの表現を意図的にそのまま再現する仕様のようです。
具体的には、`p` メソッドが出力する文字列はRubyコードのソース表現に近い形式になるため、バックスラッシュを追加することで特殊文字を明示的に示します。これにより、デバッグ時に文字列中のバックスラッシュや特殊文字を視覚的に確認しやすくなります。

## ダブルクォートでの違いを比較
ここでダブルクォートの場合も確認しておくと、違いがさらに理解しやすくなります。
```ruby
str_double = "これはダブルクォートの\n性質です"
puts str_double  # => これはダブルクォートの
                 # 性質です
p str_double     # => "これはダブルクォートの\n性質です"
```
`puts` メソッドを使うと、ダブルクォート内の `\n` が改行として解釈されます。
一方、`p` メソッドを使うと、文字列がそのまま出力されますが、改行を表す `\n` がエスケープシーケンスとして表示され、シングルクォートの場合とは異なる挙動を示します。

# まとめ
シングルクォートと `p` メソッドの組み合わせを使うと、シングルクォートで式展開が無効になることや、`p` がバックスラッシュを強調して出力するという性質が組み合わさり、普段と少し異なる出力が得られます。
特にデバッグ中にエスケープシーケンスがそのまま表示される場合や、バックスラッシュの意図しない増加が見られる場合は、シングルクォートと `p` のこの特性に注目してみると良いかもしれません。
