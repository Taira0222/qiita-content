---
title: 【Linux】sourceコマンドの仕組みを理解する
tags:
  - Linux
  - 未経験エンジニア
  - source
private: false
updated_at: '2024-10-15T23:29:58+09:00'
id: 90a6b00225d5f6ecffb1
organization_url_name: null
slide: false
ignorePublish: false
---
# はじめに
こんにちは、「ゼロからわかる Linuxコマンド200本ノック」という教材を用いてLinuxの勉強をしています
こちらの教材、なぜ？ということを先読みして書いてくれている書籍でLinux自体が難しくてわからないということはありましたが、仕組みがわかればそれについての詳細を説明してくれている書籍です
書籍の紹介はこれくらいにして、本日は本書で触れられていた`source`コマンドについて理解を深めていこうと思います

環境：
ホストOS:Winows 11
仮想化ソフトウェア:Oracle Virtualbox
ゲストOS:ubuntu 24.04.1

# `source`の概要
`source`コマンドは、スクリプトや設定ファイルを現在のシェルで実行するためのコマンドです。
`source`を使うと、新しいサブシェルを生成せずに、現在のシェル環境でコマンドが実行されます。そのため、変数の定義や設定変更が即座に現在のシェルに反映される特徴があります。

本書ではシェルスクリプトを実行する手段の1つとして挙げられていました。
ですが、`source`をシェルスクリプトで実行するのは実際にはあまり使用されておらず、`~/.bashrc`の変更を反映させるために使用するようです。

では、なぜシェルスクリプトを実行する際に`source`を使用しないのか、`source`を`~/.bashrc`の変更を反映させるためになぜ使用するのかについて説明していきます

### シェルスクリプトを実行する際に`source`を使用しない理由
シェルスクリプトを実行する際、通常は新しいサブシェルが生成されて、その中でスクリプトが実行されます。

本書でも紹介いましたが、上記の通常の新しいサブシェルが生成されるパターンを1つ紹介します
* ファイル名を指定して実行
ファイル名が`~/bin/lslink.sh`だとするとこのまま実行するケースです。通常は実行権がないので`chmod`で実行権を付与します
```
$ ~/bin/lslink.sh
bash: /home/ユーザ名/bin/lslink.sh :許可がありません

$ chmod a+x ~/bin/lslink.sh
# すべてのユーザに実行権を与える
```
話を戻しますが、このような新しいサブシェルを生成する方法では、親シェルには直接影響を与えないため、親シェル内の環境変数や設定を守りつつスクリプトを安全に実行できます。
`source`を使用すると、スクリプトが現在のシェルで実行されるため、変数や設定が親シェルに反映されてしまい、他のコマンドやプロセスに影響を与える可能性があるため、通常は避けられます。


### `source`を`~/.bashrc`の変更を反映させるために使用する理由
`~/.bashrc`は、シェルの環境設定ファイルで、エイリアスやシェル変数の定義が含まれています。`~/.bashrc`は起動時に読み込まれるファイルと思っておいてください。
通常、シェルが起動したときに自動的にこのファイルが読み込まれますが、ファイルを編集した後は再度シェルを開かない限り、変更は親シェルに反映されません。

ここで`source`が役立ちます。
`source`は通常とは違い、<strong>スクリプトが現在のシェルで実行されます。</strong>
`source ~/.bashrc`を実行することで、シェルの再起動（ログアウト・ログインや新しいターミナルの起動）をせずに、編集内容を即座に親シェルに反映させることができます。
再起動せずに、即時に新しい設定を反映できる点が`source`を使う最大の理由です。

シェルを再起動する場合、例えばターミナルを閉じて再度開く必要がありますが、作業中にこれを行うのは不便です。また、サブシェルでは親シェルの変更が反映されないため、`source`を使うことで、既存のセッションを維持しながらも新しい設定を利用することができるのでとても便利です

# まとめ
少し長くなりましたが、簡単にまとめてみました。
* sourceコマンドの役割
sourceはスクリプトや設定ファイルを新しいシェルを作らずに、現在のシェルで実行し、即座に反映させるために使います。
* シェルスクリプト実行時にsourceを使用しない理由
通常のシェルスクリプトは新しいサブシェルで実行され、親シェルに影響を与えないため、sourceは必要ありません。
* sourceを使用して~/.bashrcの変更を反映する理由
source ~/.bashrcを使うと、シェルの再起動をせずに設定変更が即座に反映されるため、効率的です。
